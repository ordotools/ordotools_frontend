<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Calendar with API</title>
    <style>
        /* Your existing CSS here - keeping it concise for the example */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }
        .calendar-container { max-width: 100vw; height: 100vh; margin: 0; padding: 10px; display: flex; flex-direction: column; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background: white; padding: 12px 16px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); flex-shrink: 0; }
        .env-indicator { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; margin-left: 8px; }
        .env-development { background: #fff3cd; color: #856404; }
        .env-production { background: #d4edda; color: #155724; }
        .status-indicator { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
        .status-loading { background: #fff3cd; color: #856404; }
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .nav-btn { background: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; transition: background 0.2s; margin: 0 2px; }
        .nav-btn:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="calendar-container">
        <div class="calendar-header">
            <div>
                <button class="nav-btn" id="prevBtn">‚Üê Prev</button>
                <button class="nav-btn" id="todayBtn">Today</button>
                <button class="nav-btn" id="nextBtn">Next ‚Üí</button>
            </div>
            <div>
                <span id="currentMonth">Calendar</span>
                <span class="env-indicator" id="envIndicator">DEV</span>
            </div>
            <div>
                <span class="status-indicator" id="statusIndicator">Ready</span>
                <button class="nav-btn" id="testBtn">Test API</button>
            </div>
        </div>
        
        <div style="flex: 1; background: white; border-radius: 6px; padding: 20px;">
            <div id="output">
                <h3>API Test Output</h3>
                <pre id="apiOutput" style="background: #f8f9fa; padding: 15px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap;">Click "Test API" to check connection...</pre>
            </div>
        </div>
    </div>

    <script>
        // Environment Configuration
        const CONFIG = {
            development: {
                API_BASE_URL: 'http://localhost:8000',
                DEBUG: true
            },
            production: {
                API_BASE_URL: 'https://api-eky0.onrender.com',
                DEBUG: false
            }
        };

        const getEnvironment = () => {
            if (window.location.hostname === 'localhost' || 
                window.location.hostname === '127.0.0.1' ||
                window.location.hostname === '') {
                return 'development';
            }
            return 'production';
        };

        const ENV = getEnvironment();
        const API_CONFIG = CONFIG[ENV];

        // Update UI based on environment
        document.getElementById('envIndicator').textContent = ENV.toUpperCase();
        document.getElementById('envIndicator').className = `env-indicator env-${ENV}`;

        console.log(`üåç Environment: ${ENV}`);
        console.log(`üîó API Base URL: ${API_CONFIG.API_BASE_URL}`);

        class TestCalendar {
            constructor() {
                this.apiBaseUrl = API_CONFIG.API_BASE_URL;
                this.init();
            }

            init() {
                this.bindEvents();
                this.updateStatus('Ready - Click Test API', 'success');
            }

            bindEvents() {
                document.getElementById('testBtn').addEventListener('click', () => {
                    this.runAPITests();
                });

                document.getElementById('prevBtn').addEventListener('click', () => {
                    this.log('Previous month navigation');
                });

                document.getElementById('nextBtn').addEventListener('click', () => {
                    this.log('Next month navigation');
                });

                document.getElementById('todayBtn').addEventListener('click', () => {
                    this.log('Today navigation');
                });
            }

            updateStatus(status, type = 'success') {
                const indicator = document.getElementById('statusIndicator');
                indicator.textContent = status;
                indicator.className = `status-indicator status-${type}`;
            }

            log(message) {
                const output = document.getElementById('apiOutput');
                const timestamp = new Date().toLocaleTimeString();
                output.textContent += `[${timestamp}] ${message}\n`;
                output.scrollTop = output.scrollHeight;
                console.log(message);
            }

            async runAPITests() {
                this.updateStatus('Testing...', 'loading');
                document.getElementById('apiOutput').textContent = '';
                
                this.log(`üß™ Starting API Tests for ${ENV} environment`);
                this.log(`üì° Base URL: ${this.apiBaseUrl}`);
                this.log('‚îÄ'.repeat(50));

                // Test 1: Root endpoint
                await this.testEndpoint('/', 'Root endpoint health check');

                // Test 2: Today endpoint
                await this.testEndpoint('/today', 'Today\'s ordo data');

                // Test 3: Specific date
                const testDate = '2024-12-25';
                await this.testEndpoint(`/day/${testDate}`, `Specific date (${testDate})`);

                // Test 4: Month data
                await this.testEndpoint('/month/2024/12', 'December 2024 data');

                // Test 5: CORS test (if cross-origin)
                if (ENV === 'development') {
                    this.log('\nüîó CORS Test:');
                    this.log('Local development - CORS should work automatically');
                } else {
                    this.log('\nüîó CORS Test:');
                    this.log('Production - Check if API has proper CORS headers');
                }

                this.log('\n‚úÖ API tests completed');
                this.updateStatus('Tests completed', 'success');
            }

            async testEndpoint(endpoint, description) {
                try {
                    this.log(`\nüîç Testing: ${description}`);
                    this.log(`   URL: ${this.apiBaseUrl}${endpoint}`);
                    
                    const startTime = Date.now();
                    const response = await fetch(`${this.apiBaseUrl}${endpoint}`);
                    const endTime = Date.now();
                    
                    this.log(`   Status: ${response.status} ${response.statusText}`);
                    this.log(`   Time: ${endTime - startTime}ms`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.log(`   Response: ${JSON.stringify(data, null, 2).substring(0, 200)}...`);
                        this.log(`   ‚úÖ SUCCESS`);
                    } else {
                        this.log(`   ‚ùå FAILED: ${response.status}`);
                    }
                } catch (error) {
                    this.log(`   ‚ùå ERROR: ${error.message}`);
                    if (error.message.includes('Failed to fetch')) {
                        this.log(`   üí° This is likely a CORS issue or the API is not running`);
                        if (ENV === 'development') {
                            this.log(`   üí° Make sure your API is running on ${this.apiBaseUrl}`);
                        }
                    }
                }
            }
        }

        // Initialize test calendar
        const testCalendar = new TestCalendar();
        window.testCalendar = testCalendar;

        // Auto-run basic test on load
        setTimeout(() => {
            testCalendar.log('üöÄ Calendar initialized');
            testCalendar.log(`Environment: ${ENV}`);
            testCalendar.log(`API URL: ${testCalendar.apiBaseUrl}`);
        }, 500);
    </script>
</body>
</html>
